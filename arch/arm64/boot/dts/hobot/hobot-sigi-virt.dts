// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Horizon Robotics Sigi Virt device tree
 *
 * Copyright (c) 2023 Beijing Horizon Robotics Co., Ltd
 */

/dts-v1/;
#include <dt-bindings/interrupt-controller/arm-gic.h>
#include <dt-bindings/interrupt-controller/irq.h>
/ {
    compatible = "hobot-sigi-virt";
    model = "Horizon Robotics Sigi Virt Development Platform";
    #address-cells = <2>;
    #size-cells = <2>;
    interrupt-parent = <&gic>;

    memory@3000000000 {
        reg = <0x30 0x00000000 0x1 0x00000000>;
        device_type = "memory";
    };

    aliases {
        serial0 = &uart0;
        serial1 = &uart1;
        serial2 = &uart2;
        serial3 = &uart3;
        mmc0 = &mmc0;
        mmc1 = &mmc1;
    };

    chosen {
        stdout-path = &uart0;
        #address-cells = <2>;
		#size-cells = <2>;
        bootargs = "earlycon=uart8250,mmio32,0x39050000,115200n8 console=ttyS0,115200 rdinit=/sbin/init root=/dev/mmcblk0p7 rw rootwait debug";
        xen,xen-bootargs = "console=dtuart, dtuart=serial0 dom0_mem=1G";
        xen,dom0-bootargs = "rdinit=/sbin/init console=hvc0,115200n8 earlycon=xenboot debug";
		module@0 {
			compatible = "xen,linux-zimage", "xen,multiboot-module";
			reg = <0x30 0x85000000 0x0 0x03000000>;
		};
    };

    timer {
        compatible = "arm,armv8-timer";
		clock-frequency = <24000000>;
		interrupts = <GIC_PPI 13 (GIC_CPU_MASK_SIMPLE(4) | IRQ_TYPE_LEVEL_LOW)>,
				<GIC_PPI 14 (GIC_CPU_MASK_SIMPLE(4) | IRQ_TYPE_LEVEL_LOW)>,
				<GIC_PPI 11 (GIC_CPU_MASK_SIMPLE(4) | IRQ_TYPE_LEVEL_LOW)>,
				<GIC_PPI 10 (GIC_CPU_MASK_SIMPLE(4) | IRQ_TYPE_LEVEL_LOW)>;
        always-on;
    };

    gic: gic@30b00000 {
        compatible = "arm,gic-v3";
        #redistributor-regions = <1>;
        #size-cells = <2>;
        #address-cells = <2>;
        interrupt-controller;
        reg = <0x0 0x30b00000 0x0 0x10000
                0x0 0x30b60000 0x0 0x1c0000>;
        interrupts = <GIC_PPI 9 IRQ_TYPE_LEVEL_HIGH>;
        #interrupt-cells = <3>;
        ranges;

        its: its@30290000 {
            compatible = "arm,gic-v3-its";
            reg = <0x0 0x30290000 0x0 0x10000>;
            msi-controller;
        };
    };

    psci {
        migrate = <0xc4000005>;
        cpu_on = <0xc4000003>;
        cpu_off = <0x84000002>;
        cpu_suspend = <0xc4000001>;
        method = "smc";
        compatible = "arm,psci-1.0", "arm,psci-0.2", "arm,psci";
    };

    apb_clk: apb-pclk {
        compatible = "fixed-clock";
        clock-output-names = "clk24mhz";
        clock-frequency = <24000000>;
        #clock-cells = <0>;
    };

    cpus {
        #size-cells = <0>;
        #address-cells = <1>;

        cpu-map {
            socket0 {
                cluster0 {
                    core0 {
                        cpu = <&cpu0>;
                    };
                    core1 {
                        cpu = <&cpu1>;
                    };
                    core2 {
                        cpu = <&cpu2>;
                    };
                    core3 {
                        cpu = <&cpu3>;
                    };
                };
            };
        };

        cpu0: cpu@0 {
            reg = <0x0>;
            enable-method = "psci";
            compatible = "arm,cortex-a78ae";
            device_type = "cpu";
        };
        cpu1: cpu@100 {
            reg = <0x100>;
            enable-method = "psci";
            compatible = "arm,cortex-a78ae";
            device_type = "cpu";
        };
        cpu2: cpu@200 {
            reg = <0x200>;
            enable-method = "psci";
            compatible = "arm,cortex-a78ae";
            device_type = "cpu";
        };
        cpu3: cpu@300 {
            reg = <0x300>;
            enable-method = "psci";
            compatible = "arm,cortex-a78ae";
            device_type = "cpu";
        };
    };

    soc {
		compatible = "simple-bus";
		#address-cells = <2>;
		#size-cells = <2>;
		ranges;

        mmc0: sdhci@39030000 {
            compatible = "cdns,sd4hc";
            reg = <0x0 0x39030000 0x0 0x10000>;
            interrupts = <GIC_SPI 0x78 IRQ_TYPE_LEVEL_HIGH>;
            clocks = <&apb_clk>;
            sdhci-caps-mask = <0xffffffff 0xffffffff>;
            sdhci-caps = <0x70 0x156ac800>;
            max-frequency = <2000000000>;
            mmc-hs200-1_8v;
            cap-mmc-highspeed;
            bus-width = <8>;
            no-sd;
            no-sdio;
            non-removable;
            cdns,phy-dll-delay-sdclk-hsmmc = <0x2d>;
            cdns,phy-dll-delay-sdclk = <0x2d>;
            cdns,phy-dll-delay-strobe = <0x21>;
            cdns,phy-input-delay-mmc-ddr = <3>;
            cdns,phy-input-delay-mmc-highspeed = <3>;
            cdns,phy-input-delay-sd-default = <8>;
        };

        mmc1: sdhci@39040000 {
            compatible = "cdns,sd4hc";
            reg = <0x0 0x39040000 0x0 0x10000>;
            interrupts = <GIC_SPI 0x7a IRQ_TYPE_LEVEL_HIGH>;
            clocks = <&apb_clk>;
            sdhci-caps-mask = <0xffffffff 0xffffffff>;
            sdhci-caps = <0x70 0x156ac800>;
            max-frequency = <2000000000>;
            bus-width = <4>;
            no-mmc;
            cap-sd-highspeed;
            cdns,phy-dll-delay-sdclk-hsmmc = <0x2d>;
            cdns,phy-dll-delay-sdclk = <0x2d>;
            cdns,phy-dll-delay-strobe = <0x21>;
            cdns,phy-input-delay-mmc-ddr = <3>;
            cdns,phy-input-delay-mmc-highspeed = <3>;
            cdns,phy-input-delay-sd-default = <8>;
        };

        uart0: serial@39050000 {
            compatible = "ns16550";
            reg = <0x0 0x39050000 0x0 0x10000>;
            interrupts = <GIC_SPI 0x49 IRQ_TYPE_LEVEL_HIGH>;
            clock-names = "apb_pclk";
            clocks = <&apb_clk>;
            reg-shift = <2>;
            reg-io-width = <4>;
            clock-frequency = <24000000>;
            current-speed = <115200>;
        };

        uart1: serial@39060000 {
            compatible = "ns16550";
            reg = <0x0 0x39060000 0x0 0x10000>;
            interrupts = <GIC_SPI 0x4a IRQ_TYPE_LEVEL_HIGH>;
            clock-names = "apb_pclk";
            clocks = <&apb_clk>;
            reg-shift = <2>;
            reg-io-width = <4>;
            clock-frequency = <24000000>;
            current-speed = <115200>;
        };

        uart2: serial@39070000 {
            compatible = "ns16550";
            reg = <0x0 0x39070000 0x0 0x10000>;
            interrupts = <GIC_SPI 0x4b IRQ_TYPE_LEVEL_HIGH>;
            clock-names = "apb_pclk";
            clocks = <&apb_clk>;
            reg-shift = <2>;
            reg-io-width = <4>;
            clock-frequency = <24000000>;
            current-speed = <115200>;
        };

        uart3: serial@39080000 {
            compatible = "ns16550";
            reg = <0x0 0x39080000 0x0 0x10000>;
            interrupts = <GIC_SPI 0x4c IRQ_TYPE_LEVEL_HIGH>;
            clock-names = "apb_pclk";
            clocks = <&apb_clk>;
            reg-shift = <2>;
            reg-io-width = <4>;
            clock-frequency = <24000000>;
            current-speed = <115200>;
        };

        usb@3a000000 {
            compatible = "hobot,sigi-dwc3";
            reg = <0x0 0x3a000000 0x0 0x10000>;
            #size-cells = <2>;
            #address-cells = <2>;
            ranges;
            
            dwc_usb@3a820000 {
                compatible = "snps,dwc3";
                reg = <0x0 0x3a820000 0x0 0x10000>;
                interrupts = <GIC_SPI 0x84 IRQ_TYPE_LEVEL_HIGH>;
                interrupt-names = "dwc_usb3";
                snps,xhci-stream-quirk;
                snps,enable_guctl1_ipd_quirk;
                snps,enable_guctl1_resume_quirk;
                snps,refclk_fladj;
                snps,quirk-frame-length-adjustment = <0x20>;
                #stream-id-cells = <1>;
                phy-names = "usb3-phy";
                dr_mode = "host";
            };
        };

        pcie@34000000 {
            compatible = "pci-host-ecam-generic";
            reg = <0x0 0x34000000 0x0 0x400000>;
            device_type = "pci";
            interrupt-map-mask = <0x1800 0x0 0x0 0x7>;
            interrupt-map = <0x0 0x0 0x0 0x1 &gic 0x0 0x0 GIC_SPI 0x7f IRQ_TYPE_LEVEL_HIGH
                             0x0 0x0 0x0 0x2 &gic 0x0 0x0 GIC_SPI 0x80 IRQ_TYPE_LEVEL_HIGH
                             0x0 0x0 0x0 0x3 &gic 0x0 0x0 GIC_SPI 0x81 IRQ_TYPE_LEVEL_HIGH
                             0x0 0x0 0x0 0x4 &gic 0x0 0x0 GIC_SPI 0x82 IRQ_TYPE_LEVEL_HIGH
                             0x800 0x0 0x0 0x1 &gic 0x0 0x0 GIC_SPI 0x80 IRQ_TYPE_LEVEL_HIGH
                             0x800 0x0 0x0 0x2 &gic 0x0 0x0 GIC_SPI 0x81 IRQ_TYPE_LEVEL_HIGH 
                             0x800 0x0 0x0 0x3 &gic 0x0 0x0 GIC_SPI 0x82 IRQ_TYPE_LEVEL_HIGH 
                             0x800 0x0 0x0 0x4 &gic 0x0 0x0 GIC_SPI 0x7f IRQ_TYPE_LEVEL_HIGH 
                             0x1000 0x0 0x0 0x1 &gic 0x0 0x0 GIC_SPI 0x81 IRQ_TYPE_LEVEL_HIGH 
                             0x1000 0x0 0x0 0x2 &gic 0x0 0x0 GIC_SPI 0x82 IRQ_TYPE_LEVEL_HIGH 
                             0x1000 0x0 0x0 0x3 &gic 0x0 0x0 GIC_SPI 0x7f IRQ_TYPE_LEVEL_HIGH 
                             0x1000 0x0 0x0 0x4 &gic 0x0 0x0 GIC_SPI 0x80 IRQ_TYPE_LEVEL_HIGH 
                             0x1800 0x0 0x0 0x1 &gic 0x0 0x0 GIC_SPI 0x82 IRQ_TYPE_LEVEL_HIGH 
                             0x1800 0x0 0x0 0x2 &gic 0x0 0x0 GIC_SPI 0x7f IRQ_TYPE_LEVEL_HIGH 
                             0x1800 0x0 0x0 0x3 &gic 0x0 0x0 GIC_SPI 0x80 IRQ_TYPE_LEVEL_HIGH 
                             0x1800 0x0 0x0 0x4 &gic 0x0 0x0 GIC_SPI 0x81 IRQ_TYPE_LEVEL_HIGH>;
            #interrupt-cells = <1>;
            ranges = <0x01000000 0x0 0x70000000 0x0 0x70000000 0x0 0x10000
                      0x02000000 0x0 0x80000000 0x0 0x80000000 0x0 0x40000000
                      0x03000000 0x80 0x00000000 0x80 0x00000000 0x80 0x00000000>;
            msi-parent = <&its>;
            dma-coherent;
            bus-range = <0x00 0xff>;
            linux,pci-domain = <0>;
            #size-cells = <2>;
            #address-cells = <3>;
        };

        gpio0: gpio@3a120000 {
            #size-cells = <0>;
            #address-cells = <1>;
            compatible = "snps,dw-apb-gpio";
            reg = <0x0 0x3a120000 0x0 0x10000>;

            port@0 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <0>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                interrupts = <GIC_SPI 0x4e IRQ_TYPE_LEVEL_HIGH>;
                #interrupt-cells = <2>;
                interrupt-controller;
                bank-name = "gpio0_a";
            };

            port@1 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <1>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                bank-name = "gpio0_b";
            };

            port@2 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <2>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                bank-name = "gpio0_c";
            };

            port@3 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <3>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                bank-name = "gpio0_d";
            };
        };

        gpio1: gpio@3a130000 {
            #size-cells = <0>;
            #address-cells = <1>;
            compatible = "snps,dw-apb-gpio";
            reg = <0x0 0x3a130000 0x0 0x10000>;

            port@0 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <0>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                interrupts = <GIC_SPI 0x4f IRQ_TYPE_LEVEL_HIGH>;
                #interrupt-cells = <2>;
                interrupt-controller;
                bank-name = "gpio1_a";
            };

            port@1 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <1>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                bank-name = "gpio1_b";
            };

            port@2 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <2>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                bank-name = "gpio1_c";
            };

            port@3 {
                compatible = "snps,dw-apb-gpio-port";
                reg = <3>;
                snps,nr-gpios = <32>;
                #gpio-cells = <2>;
                gpio-controller;
                bank-name = "gpio1_d";
            };
        };
    };
};
